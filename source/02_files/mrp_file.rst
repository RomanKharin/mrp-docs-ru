Формат MRP
==========

Файл, предназначенный для распространения программ платформы MRP. 

Расширение - ``mrp``.

Структура файла предствалена в таблице 1

Таблица 1
~~~~~~~~~

+----------+-----------------------+
| Смещение | Тип                   | 
+==========+=======================+
| 0x00     | MAGIC константа       |
+----------+-----------------------+
| 0x04     | Заголовок             |
+----------+-----------------------+
| 0xF0     | Расширенный заголовок |
+----------+-----------------------+
| ...      | Индексная таблица     |
+----------+-----------------------+
| ...      | Файловая таблица      |
+----------+-----------------------+

MAGIC
-----
Контанта для идентификации типа файла. Имеет значение 0х4D525047 ("MRPG").

Заголовок
---------

Структура заголовка приведена в таблице 2. 

Все строки фиксированной длины должны быть дополнены нулями до нужного размера.
Кодировка символов обычно "Китайский упрощённый GB-2312", но определение кодировки
выполняется непосредственно программой читающей эти строки, например, приложением
отображающем список установленных программ (``dsm_gm.mrp``).

Все цифровые поля в LE, за исключением указанных.

Таблица 2
~~~~~~~~~

+----------+-------+-------------+---------------------------------------------+
| Смещение | Длина | Значение    | Описание                                    |
+==========+=======+=============+=============================================+
|     0x04 |    4  | headlen     | Длина заголовка                             |
+----------+-------+-------------+---------------------------------------------+
|     0x08 |    4  | filelen     | Длина файла                                 |
+----------+-------+-------------+---------------------------------------------+
|     0x0С |    4  | index       | Начало индексной таблицы                    |
+----------+-------+-------------+---------------------------------------------+
|     0x10 |   12  | filename    | Имя файла при компиляции (может не          |
|          |       |             | совпадать текущим именем файла)             |
+----------+-------+-------------+---------------------------------------------+
|     0x1С |   24  | appame      | Имя программы                               |
+----------+-------+-------------+---------------------------------------------+
|     0x34 |   16  | authcode    | Код авторизации компилятора                 |
+----------+-------+-------------+---------------------------------------------+
|     0x44 |    4  | appid       | ID приложения                               |
+----------+-------+-------------+---------------------------------------------+
|     0x48 |    4  | appver      | Версия приложения                           |
+----------+-------+-------------+---------------------------------------------+
|     0x4C |    4  | flags       | Флаги                                       |
+----------+-------+-------------+---------------------------------------------+
|     0x50 |    4  | formatver   | Версия формата                              |
+----------+-------+-------------+---------------------------------------------+
|     0x54 |    4  | crc32       | Контрольная сумма CRC32. Вычисляется от     |
|          |       |             | всего  файла, за исключением самого поля,   |
|          |       |             | вместо него 4 нулевых байта.                |
+----------+-------+-------------+---------------------------------------------+
|     0x58 |   40  | vendor      | Производитель (или автор)                   |
+----------+-------+-------------+---------------------------------------------+
|     0x80 |   64  | description | Описание                                    |
+----------+-------+-------------+---------------------------------------------+
|     0xС0 |    4  | appid       | ID приложения (в BE)                        |
+----------+-------+-------------+---------------------------------------------+
|     0xС4 |    4  | appver      | Версия приложения (в BE)                    |
+----------+-------+-------------+---------------------------------------------+
|     0xС8 |    4  | UNKNOWN     | ..here dragons...                           |
+----------+-------+-------------+---------------------------------------------+
|     0xСC |    2  | scr_width   | Ширина экрана (или 0)                       |
+----------+-------+-------------+---------------------------------------------+
|     0xСE |    2  | scr_height  | Высота экрана (или 0)                       |
+----------+-------+-------------+---------------------------------------------+
|     0xD0 |    1  | platform    | Тип аппаратной платформы                    |
+----------+-------+-------------+---------------------------------------------+
|     0xD1 |   31  | padding     | 31 нулевой байт (выравнивание для           | 
|          |       |             | совместимости)                              |
+----------+-------+-------------+---------------------------------------------+

Поле headlen
~~~~~~~~~~~~

Поле определяет длину заголовка. Оно совместимости со старыми файлами. Если 
длина заголовка не более 232 байт - то файл использует старый формат. Иначе новый.

Старый формат отличается тем что не имеет расширенного заголовка и индексной 
таблицы. Из-за этого для поиска файла с конкретным именем необходимо 
просматривать файловую таблицу полностью.

Длина указанная в поле на 8 меньше реальной длины заголовка в байтах.

Поле authcode
~~~~~~~~~~~~~

Authorization code, no-brain task.


Поле flags
~~~~~~~~~~

Биты:

::

  0 - visible (видимость в списке программ)
  1 .. 2 - cpu (тип процессора)
  3 .. - shell


Поле formatver
~~~~~~~~~~~~~~

Format version: 0x2710 (10000) или 0x2712 (10002)

Другие значения пока не встречались.


Поле platform
~~~~~~~~~~~~~
::

  0 - не указано
  1 - MTK или MSTAR
  2 - SPREADSTRUM

Тип аппаратной платформы указывается для справки, при запуске программы 
соответствие не всегда проверяется. Бинарные компоненты (``.ext``) должны быть 
скомпилированы для конкретной аппаратной платформы.


Расширенный заголовок
---------------------



Индексная таблица
-----------------

Файловая таблица
----------------


